<!DOCTYPE html>
<html>
<head>
    <title>Feature Test Case Coverage Report</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("Rally.technicalservices.InfoLink",{extend:"Rally.ui.dialog.Dialog",alias:"widget.tsinfolink",informationHtml:null,title:"Build Information",defaults:{padding:5,margin:5},closable:!0,draggable:!0,autoShow:!0,width:350,informationalConfig:null,showLog:!1,logger:null,items:[{xtype:"container",itemId:"information"},{xtype:"container",itemId:"button_box"}],initComponent:function(){Ext.id(this);this.title="<span class='icon-help'> </span>"+this.title,this.callParent(arguments)},_generateChecksum:function(t){var i,n=305419896;for(t=(t=(t=t.replace(/var CHECKSUM = .*;/,"")).replace(/var BUILDER  = .*;/,"")).replace(/\s/g,""),i=0;i<t.length;i++)n+=t.charCodeAt(i)*i;return n},_checkChecksum:function(t){var i=Ext.create("Deft.Deferred"),n=this;return Ext.Ajax.request({url:document.URL,params:{id:1},success:function(t){if(text=t.responseText,CHECKSUM){var e=n._generateChecksum(text);if(CHECKSUM!==e)return void i.resolve(!1)}i.resolve(!0)}}),i.promise},_addToContainer:function(t){var i=Ext.apply({xtype:"container",height:200,overflowY:!0},this.informationalConfig);t.add(i)},afterRender:function(){var t=Rally.getApp();if(!Ext.isEmpty(this.informationalConfig)){var i=this.down("#information");this._addToContainer(i)}this.showLog&&this.logger&&this.down("#button_box").add({xtype:"rallybutton",text:"Show Log",listeners:{scope:this,click:function(){this.logger.displayLog()}}}),t.isExternal()?this.addDocked({xtype:"container",cls:"build-info",padding:2,dock:"bottom",html:"... Running externally"}):this._checkChecksum(t).then({scope:this,success:function(t){t||this.addDocked({xtype:"container",cls:"build-info",dock:"bottom",padding:2,html:'<span class="icon-warning"> </span>Checksums do not match'})},failure:function(t){console.log("oops:",t)}}),this.callParent(arguments)},beforeRender:function(){if(this.callParent(arguments),this.informationHtml&&this.addDocked({xtype:"component",componentCls:"intro-panel",padding:2,html:this.informationHtml,dock:"bottom"}),this.addDocked({xtype:"container",cls:"build-info",padding:2,dock:"bottom",html:"This app was created by the CA AC Technical Services Team."}),APP_BUILD_DATE){var t=Ext.String.format("Built on: {0} <br/>Built by: {1}",APP_BUILD_DATE,BUILDER);ARTIFACT&&(t=t+"<br/>Source artifact: "+ARTIFACT),this.addDocked({xtype:"container",cls:"build-info",padding:2,dock:"top",html:t})}}});
                Ext.define("CArABU.technicalservices.Logger",{saveForLater:!1,saveLines:100,logArray:[],constructor:function(t){Ext.apply(this,t)},setSaveForLater:function(t){this.saveForLater=t},log:function(t){var o="[ "+Ext.util.Format.date(new Date,"Y-m-d H:i:s.u")+" ]",e=[];e=Ext.Array.push(e,[o]),e=Ext.Array.push(e,Ext.Array.slice(arguments,0)),this.saveForLater&&(this.logArray||(this.logArray=[]),this.logArray.push(e.join(" ")),this.logArray.length>this.saveLines&&this.logArray.shift()),window.console&&console.log.apply(console,e)},getLogText:function(){return this.logArray&&0!==this.logArray.length?this.logArray.join("<br/>"):"-- no log --"},displayLog:function(){var t=this.getLogText();this.popup=Ext.create("Rally.ui.dialog.Dialog",{width:Ext.getBody().getWidth()-20,height:Ext.getBody().getHeight()-20,closable:!0,title:"Log",autoShow:!0,layout:"border",defaults:{layout:"fit",width:"50%",border:!1},items:[{region:"center",xtype:"container",html:t,autoScroll:!0}]})}});
                Ext.define("TSUtilities",{singleton:!0,loadWsapiRecords:function(e){var r=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",Ext.Object.merge({model:"Defect",fetch:["ObjectID"]},e)).load({callback:function(e,o,t){t?r.resolve(e):(console.error("Failed: ",o),r.reject("Problem loading: "+o.error.errors.join(". ")))}}),r.promise},loadAStoreWithAPromise:function(e,r){var o=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",{model:e,fetch:r}).load({callback:function(e,r,t){t?o.resolve(this):(console.error("Failed: ",r),o.reject("Problem loading: "+r.error.errors.join(". ")))}}),o.promise}});
                Ext.define("CArABU.technicalservices.chunk.Store",{MAX_CHUNK_SIZE:50,logger:new CArABU.technicalservices.Logger,constructor:function(e){this.chunkProperty=e.chunkProperty,this.chunkValue=e.chunkValue,this.storeConfig=e.storeConfig||{},this.storeType=e.storeType||"Rally.data.wsapi.Store"},load:function(){for(var e=Ext.create("Deft.Deferred"),t=[],r=this.chunkValue,o=this.storeConfig,i=0;i<r.length;i+=this.MAX_CHUNK_SIZE){var l=Ext.Array.slice(r,i,i+this.MAX_CHUNK_SIZE);t.push(this._fetchChunk(l,o))}return Deft.Promise.all(t).then({success:function(t){var r=_.flatten(t);this.logger.log("load SUCCESS results",t,r),e.resolve(r)},failure:function(t){this.logger.log("load FAILURE",r,t),e.reject(t)},scope:this}),e},_fetchChunk:function(e,t){this.logger.log("chunk.Store._fetchChunk",e,t);var r=Ext.create("Deft.Deferred"),o=this.chunkProperty,i=_.map(e,function(e){return{property:o,value:e}});i=Rally.data.wsapi.Filter.or(i),t.filters&&(Ext.isArray(t.filters)&&(t.filters=Rally.data.wsapi.Filter.and(t.filters)),i=i.and(t.filters)),this.logger.log("chunk.Store._fetchChunk",i.toString());var l=t.fetch||!0,s=t.model||"HierarchicalRequirement";return Ext.create(this.storeType,{fetch:l,filters:i,model:s,context:{project:null}}).load({callback:function(t,o,i){if(i)r.resolve(t);else{var l="Failure loading records for objectIDs: "+e.join(", ")+":  "+o.error.errors.join(",");r.resolve(l)}}}),r}});
                Ext.override(Rally.ui.gridboard.SharedViewComboBox,{_isViewPreference:function(e){return"preference"===e.self.typePath&&"View"===e.get("Type")&&e.get("AppId")==this.getContext().getAppId()}}),Ext.override(Rally.data.wsapi.TreeStore,{_decorateModels:function(){var e=this.model;_.isFunction(e.getArtifactComponentModels)&&(e=e.getArtifactComponentModels()),Ext.Array.each(e,function(e){e.addField({name:"Passing",type:"auto",defaultValue:0}),e.addField({name:"Failing",type:"auto",defaultValue:0}),e.addField({name:"NoRun",type:"auto",defaultValue:0}),e.addField({name:"Other",type:"auto",defaultValue:0}),e.addField({name:"TotalStories",type:"auto",defaultValue:0}),e.addField({name:"TotalCovered",type:"auto",defaultValue:0})}),_.each(Ext.Array.from(e),Rally.ui.grid.data.NodeInterface.decorate,Rally.ui.grid.data.NodeInterface)}}),Ext.override(Rally.ui.grid.TreeGrid,{_mergeColumnConfigs:function(e,t){var a=_.map(e,function(e){var a=_.find(t,{dataIndex:this._getColumnName(e)});return a?this._getColumnConfigFromColumn(a):e},this);return this.config&&this.config.derivedColumnCfgs&&(a=a.concat(this.config.derivedColumnCfgs)),a},_getColumnConfigsBasedOnCurrentOrder:function(e){return _(this.headerCt.items.getRange()).map(function(t){return _.contains(e,t.dataIndex)?t.dataIndex:_.find(e,{xtype:t.xtype,text:t.text})}).compact().value()},_restoreColumnOrder:function(e){var t=this._getColumnConfigsBasedOnCurrentOrder(e),a=_.filter(e,function(e){return!_.find(t,{dataIndex:e.dataIndex})||Ext.isString(e)});return t.concat(a)},_applyStatefulColumns:function(e){this.alwaysShowDefaultColumns&&_.each(this.columnCfgs,function(t){_.any(e,{dataIndex:this._getColumnName(t)})||e.push(t)},this),this.config&&this.config.derivedColumnCfgs&&_.each(this.config.derivedColumnCfgs,function(t){var a=this._getColumnName(t),n=_.find(e,function(e){return e.dataIndex===a||e.text===a});n?_.merge(n,t):e.push(t)},this),this.columnCfgs=e},_getPersistableColumnConfig:function(e){var t=this._getColumnConfigFromColumn(e),a=this._getModelField(t.dataIndex);return a&&a.getUUID&&(t.dataIndex=a.getUUID()),t},_getColumnName:function(e){var t="";return _.isString(e)?t=e:e&&e.dataIndex?t=e.dataIndex:e&&e.text&&(t=e.text),t}}),Ext.override(Rally.data.wsapi.ParentChildMapper,{constructor:function(){this.parentChildTypeMap={hierarchicalrequirement:[{typePath:"defect",collectionName:"Defects",parentField:"Requirement"},{typePath:"testcase",collectionName:"TestCases",parentField:"WorkProduct"},{typePath:"hierarchicalrequirement",collectionName:"Children",parentField:"Parent"}],defect:[{typePath:"testcase",collectionName:"TestCases",parentField:"WorkProduct"}],defectsuite:[{typePath:"defect",collectionName:"Defects",parentField:"DefectSuites"},{typePath:"testcase",collectionName:"TestCases",parentField:"WorkProduct"}],testset:[{typePath:"testcase",collectionName:"TestCases",parentField:"TestSets"}],testcase:[{typePath:"defect",collectionName:"Defects",parentField:"TestCase"}],attributedefinition:[{typePath:"allowedattributevalue",collectionName:"AllowedValues",parentField:"AttributeDefinition"}]}}});
                Ext.define("CArABU.technicalservices.ResultGraphTemplate",{extend:"Ext.XTemplate",width:"90%",height:"20px",config:{calculateColorFn:function(t){return colors[t]},getContainerClass:function(t){return""},getClickableClass:function(){return""},getDimensionStyle:function(){return"width: "+this.width+"; height: "+this.height+"; line-height: "+this.height+";display: inline-block"},calculateWidth:function(t,e){var i=Ext.Array.sum(Ext.Object.getValues(t));return i>0?(t[e]||0)/i*100+"%":0}},constructor:function(t){return this.callParent(["<tpl>",'<div class="progress-bar-container {[this.getClickableClass()]} {[this.getContainerClass(values)]}" style="{[this.getDimensionStyle()]}">','<tpl foreach=".">','<div class="rly-progress-bar" style="text-align:center;background-color: {$}; width: {[this.calculateWidth(parent,xkey)]}; "></div>',"</tpl>","</div>","</tpl>"])}});
                Ext.define("CArABU.app.TSApp",{extend:"Rally.app.App",componentCls:"app",logger:new CArABU.technicalservices.Logger,items:[{xtype:"container",itemId:"selector_box",layout:{type:"hbox"}},{xtype:"container",itemId:"top_box",layout:{type:"vbox"},items:[{xtype:"container",itemId:"totals_f_box",layout:{type:"hbox"},margin:5},{xtype:"container",itemId:"totals_box",layout:{type:"hbox"},margin:5}]},{xtype:"container",itemId:"display_box"}],integrationHeaders:{name:"CArABU.app.TSApp"},config:{defaultSettings:{gridWidth:1200}},modelNames:["PortfolioItem/Feature"],launch:function(){var e=this;this.logger.setSaveForLater(this.getSetting("saveLog")),e._addSelector(),setTimeout(function(){e.updateView()},500)},_addSelector:function(){this.down("#selector_box").add([{xtype:"rallyreleasecombobox",name:"releaseCombo",itemId:"releaseCombo",stateful:!0,stateId:"releaseCombo-feature-test-case",fieldLabel:"Select Release:",multiSelect:!0,margin:"10 10 10 10",width:450,labelWidth:100,cls:"rally-checkbox-combobox",valueField:"Name",showArrows:!1,displayField:"Name",listConfig:{cls:"rally-checkbox-boundlist",itemTpl:Ext.create("Ext.XTemplate",'<div class="rally-checkbox-image"></div>',"{[this.getDisplay(values)]}</div>",{getDisplay:function(e){return e.Name}})}},{xtype:"rallybutton",name:"updateButton",itemId:"updateButton",margin:"10 10 10 10",text:"Update",listeners:{click:this.updateView,scope:this}}])},updateView:function(){var e=this;if(e.down("#releaseCombo"))if(0!=e.down("#releaseCombo").valueModels.length){var t=[];e.setLoading(!0),e._getSelectedPIs(e.modelNames[0]).then({success:function(a){0==a.length&&e.showErrorNotification("No Data found!"),Ext.Array.each(a,function(e){t.push(e.get("ObjectID"))}),Deft.Promise.all([e._getTCFromSnapShotStore(t),e._getUSFromSnapShotStore(t)]).then({success:function(t){console.log("results",t),e.lb_tc_results=t[0];var a=[];e.lb_us_results=t[1];Ext.Array.each(t[0],function(e){a.push(e.get("_ItemHierarchy")[e.get("_ItemHierarchy").length-2])}),e._getTCs(a).then({success:function(t){console.log("_getTCs>>",t),e.lastVerdict={},Ext.Array.each(t,function(t){e.lastVerdict[t.get("ObjectID")]=t.get("LastVerdict")}),Ext.create("Rally.data.wsapi.TreeStoreBuilder").build({models:e.modelNames,enableHierarchy:!0}).then({success:e._addGrid,scope:e})},scope:e})},scope:e})},scope:e}).always(function(){e.setLoading(!1)})}else Rally.ui.notify.Notifier.showError({message:"Please select one or more releases to display the report"})},_getSelectedPIs:function(e,t){var a={model:e,fetch:["ObjectID","FormattedID"],limit:"Infinity"};return t&&(a.filters=t),this._loadWsapiRecords(a)},_getTCs:function(e){var t=Ext.create("Deft.Deferred");return Ext.create("CArABU.technicalservices.chunk.Store",{storeConfig:{model:"TestCase",fetch:["ObjectID","LastVerdict"]},chunkProperty:"WorkProduct.ObjectID",chunkValue:e}).load().then({success:function(e){t.resolve(e)},failure:this.showErrorNotification,scope:this}),t.promise},_getUserStories:function(e){var t=Ext.create("Deft.Deferred");return Ext.create("CArABU.technicalservices.chunk.Store",{storeConfig:{model:"HierarchicalRequirement",fetch:["ObjectID"]},chunkProperty:"ObjectID",chunkValue:e}).load().then({success:function(e){t.resolve(e)},failure:this.showErrorNotification,scope:this}),t.promise},_getTCFromSnapShotStore:function(e){var t=this,a=Ext.create("Deft.Deferred"),r={_TypeHierarchy:"TestCase",_ItemHierarchy:{$in:e},__At:"current"};return Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["ObjectID","FormattedID","Name","WorkProduct","LastVerdict","_ItemHierarchy","Method"],find:r,useHttpPost:!0,sort:{},removeUnauthorizedSnapshots:!0}).load({callback:function(e,r){r.wasSuccessful()?a.resolve(e):(403===r.error.status?t.showErrorNotification("You do not have required permissions to access the data."):t.showErrorNotification("Problem Loading"),t.setLoading(!1))},scope:t}),a},_getUSFromSnapShotStore:function(e){var t=this,a=Ext.create("Deft.Deferred"),r={_TypeHierarchy:"HierarchicalRequirement",_ItemHierarchy:{$in:e},DirectChildrenCount:0,__At:"current"};return Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["ObjectID","_ItemHierarchy","FormattedID","TestCases"],find:r,useHttpPost:!0,sort:{},removeUnauthorizedSnapshots:!0}).load({callback:function(e,r){r.wasSuccessful()?a.resolve(e):(403===r.error.status?t.showErrorNotification("You do not have required permissions to access the data."):t.showErrorNotification("Problem Loading"),t.setLoading(!1))},scope:t}),a},_addGrid:function(e){var t=this,a=t.getContext();e.on("load",t._updateAssociatedData,t);var r=[];Ext.Array.each(t.down("#releaseCombo").value,function(e){r.push({property:"Release.Name",value:e})}),r=Rally.data.wsapi.Filter.or(r),console.log("Filter>>",r&&r.toString()),t.down("#display_box").removeAll(),t.down("#display_box").add({itemId:"pigridboard",xtype:"rallygridboard",context:a,modelNames:t.modelNames,toggleState:"grid",border:1,style:{borderColor:"lightblue",borderStyle:"solid"},plugins:t._getPlugins(),gridConfig:{store:e,enableEditing:!1,storeConfig:{filters:r},stateful:!0,stateId:a.getScopedStateId("gridboard_state"),columnCfgs:t._getColumnCfgs(),derivedColumnCfgs:t.getDerivedColumns(),shouldShowRowActionsColumn:!1,enableRanking:!1,enableBulkEdit:!1,sortableColumns:!0,viewConfig:{xtype:"rallytreeview",enableTextSelection:!1,animate:!1,loadMask:!1,listeners:{cellclick:t.showDrillDown,scope:t}}},listeners:{load:t._addTotals,viewChange:t.updateView,scope:t},height:500,width:t.getSetting("gridWidth")}),t.setLoading(!1)},_addTotals:function(e){var t=this,a=e&&e.gridConfig.store.filters.items;t.setLoading("Loading totals..."),t._getSelectedPIs(t.modelNames[0],a).then({success:function(e){var a={value:0,records:[]},r={value:0,records:[]},o={value:0,records:[]},l={value:0,records:[]},i={value:0,records:[]},s=0,n=0,d={},c={};Ext.Array.each(e,function(e){d[e.get("FormattedID")]={grandTotal:0,totalPass:0,totalFail:0,totalNoRun:0,totalOther:0,totalAutomated:0},Ext.Array.each(t.lb_tc_results,function(n){Ext.Array.contains(n.get("_ItemHierarchy"),e.get("ObjectID"))&&(c={ObjectID:n.get("ObjectID"),FormattedID:n.get("FormattedID"),Name:n.get("Name"),Method:n.get("Method")},i.value++,i.records.push(c),d[e.get("FormattedID")]?d[e.get("FormattedID")].grandTotal++:d[e.get("FormattedID")]={grandTotal:1,totalPass:0,totalFail:0,totalNoRun:0,totalOther:0,totalAutomated:0},"Automated"==n.get("Method")&&(s++,d[e.get("FormattedID")].totalAutomated++),"Pass"==t.lastVerdict[n.get("ObjectID")]?(a.value++,a.records.push(c),d[e.get("FormattedID")].totalPass++):"Fail"==t.lastVerdict[n.get("ObjectID")]?(r.value++,r.records.push(c),d[e.get("FormattedID")].totalFail++):null==t.lastVerdict[n.get("ObjectID")]||""==t.lastVerdict[n.get("ObjectID")]?(o.value++,o.records.push(c),d[e.get("FormattedID")].totalNoRun++):(l.value++,l.records.push(c),d[e.get("FormattedID")].totalOther++))})}),i.value>0&&(n=Ext.Number.toFixed(s/i.value*100,2)),console.log("feature_totals>>",d);var u=0,g=0,h=0,p=0;t.passingFeatureFilters=[],_.each(d,function(e,a){e.grandTotal===e.totalPass&&e.grandTotal>0&&(u++,t.passingFeatureFilters.push({property:"FormattedID",operator:"!=",value:a})),e.totalFail>0&&g++,e.grandTotal>0&&0===e.totalFail&&(e.totalNoRun>0||e.totalOther>0)&&h++,0===e.totalFail&&0===e.totalPass&&0===e.totalNoRun&&0===e.totalOther&&p++}),console.log("passingFeatureFilters>>",t.passingFeatureFilters),t.down("#totals_f_box").removeAll(),t.down("#totals_box").removeAll(),Ext.create("Ext.data.Store",{storeId:"totalStore",fields:["GrandTotal","PctAutomated","TotalPass","TotalFail","TotalNoRun","TotalOther"],data:{items:[{GrandTotal:i,PctAutomated:n,TotalPass:a,TotalFail:r,TotalNoRun:o,TotalOther:l}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),t.down("#totals_box").add({xtype:"grid",title:"Test Case Coverage",header:{style:{background:"lightBlue",color:"white","font-weight":"bold"}},sortableColumns:!1,enableColumnHide:!1,store:Ext.data.StoreManager.lookup("totalStore"),columns:[{text:"Total",dataIndex:"GrandTotal",flex:1,renderer:function(e){return e.value>0?'<a href="#">'+e.value+"</a>":0}},{text:"% Automated",dataIndex:"PctAutomated",flex:1,renderer:function(e){return e+" %"}},{text:"Passing",dataIndex:"TotalPass",flex:1,renderer:function(e){return e.value>0?'<a href="#">'+e.value+"</a>":0}},{text:"Failing",dataIndex:"TotalFail",flex:1,renderer:function(e){return e.value>0?'<a href="#">'+e.value+"</a>":0}},{text:"No Run",dataIndex:"TotalNoRun",flex:1,renderer:function(e){return e.value>0?'<a href="#">'+e.value+"</a>":0}},{text:"Other",dataIndex:"TotalOther",flex:1,renderer:function(e){return e.value>0?'<a href="#">'+e.value+"</a>":0}}],width:600,viewConfig:{listeners:{cellclick:this.showDrillDown,scope:t}}}),Ext.create("Ext.data.Store",{storeId:"totalFeatureStore",fields:["GrandTotal","FeaturePassing","FeatureFailing","FeatureNoRun","FeatureNotCovered"],data:{items:[{GrandTotal:e.length,FeaturePassing:u,FeatureFailing:g,FeatureNoRun:h,FeatureNotCovered:p}]},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),t.down("#totals_f_box").add({xtype:"grid",title:"Feature Coverage",header:{style:{background:"lightBlue",color:"white","font-weight":"bold"}},sortableColumns:!1,enableColumnHide:!1,store:Ext.data.StoreManager.lookup("totalFeatureStore"),columns:[{text:"Total Features",dataIndex:"GrandTotal",flex:1},{text:"Passing Features",dataIndex:"FeaturePassing",flex:1},{text:"Failing Features",dataIndex:"FeatureFailing",flex:1},{text:"Incomplete <br>Features",dataIndex:"FeatureNoRun",flex:1},{text:"Not Covered <br>Features",dataIndex:"FeatureNotCovered",flex:1}],width:500}),t.down("#totals_f_box").add({margin:5,xtype:"rallybutton",text:"Hide Passing <br>Features",listeners:{click:function(e){t._hidePassingFeatures()}},scope:t}),t.setLoading(!1)},scope:t})},_hidePassingFeatures:function(){var e=this,t=Rally.data.wsapi.Filter.and(e.passingFeatureFilters);console.log(e.down("#pigridboard"),e.passingFeatureFilters);var a=e.down("#pigridboard"),r=a&&a.gridConfig.store.filters.items;r.push(t),a.applyCustomFilter(Ext.apply({recordMetrics:!0,types:e.modelNames,filters:_.compact(r)}))},_updateAssociatedData:function(e,t,a,r){var o=this;o.suspendLayouts();var l={};Ext.Array.each(a,function(e){var t={value:0,records:[]},a={value:0,records:[]},r={value:0,records:[]},i={value:0,records:[]},s=0,n=0;Ext.Array.each(o.lb_tc_results,function(s){l={ObjectID:s.get("ObjectID"),FormattedID:s.get("FormattedID"),Name:s.get("Name"),Method:s.get("Method")},Ext.Array.contains(s.get("_ItemHierarchy"),e.get("ObjectID"))&&("Pass"==o.lastVerdict[s.get("ObjectID")]?(t.records.push(l),t.value++):"Fail"==o.lastVerdict[s.get("ObjectID")]?(a.records.push(l),a.value++):null==o.lastVerdict[s.get("ObjectID")]||""==o.lastVerdict[s.get("ObjectID")]?(r.records.push(l),r.value++):(i.records.push(l),i.value++))}),Ext.Array.each(o.lb_us_results,function(t){Ext.Array.contains(t.get("_ItemHierarchy"),e.get("ObjectID"))&&(s++,""!=t.get("TestCases")&&t.get("TestCases")&&t.get("TestCases").length>0&&n++)}),e.set("Passing",t),e.set("Failing",a),e.set("NoRun",r),e.set("Other",i),e.set("TotalStories",s),e.set("TotalCovered",n)}),o.resumeLayouts()},_getPlugins:function(){var e=this,t=[{ptype:"rallygridboardinlinefiltercontrol",inlineFilterButtonConfig:{stateful:!0,stateId:e.getContext().getScopedStateId("filters"),modelNames:e.modelNames,inlineFilterPanelConfig:{collapsed:!1,quickFilterPanelConfig:{defaultFields:["ArtifactSearch","Owner"],addQuickFilterConfig:{whiteListFields:["Milestones","Tags"]}},advancedFilterPanelConfig:{advancedFilterRowsConfig:{propertyFieldConfig:{whiteListFields:["Milestones","Tags"]}}}}}}];return t.push({ptype:"rallygridboardfieldpicker",headerPosition:"left",modelNames:e.modelNames,stateful:!0,gridAlwaysSelectedValues:["Name"],stateId:e.getContext().getScopedStateId("field-picker")}),t.push({ptype:"rallygridboardsharedviewcontrol",stateful:!0,stateId:e.getContext().getScopedStateId("feature-view"),stateEvents:["select","beforedestroy"],margin:5}),t},_getColumnCfgs:function(){return[{dataIndex:"Name",text:"Name",flex:1}].concat(this.getDerivedColumns())},getDerivedColumns:function(){var e=this;return[{tpl:'<div style="text-align:center;"></div>',text:"Result Graph",xtype:"templatecolumn",renderer:function(e,t,a){var r={lightgreen:a.get("Passing").value,red:a.get("Failing").value,yellow:a.get("NoRun").value,blue:a.get("Other").value};return r&&Ext.isObject(r)?Ext.create("CArABU.technicalservices.ResultGraphTemplate").apply(r):""}},{tpl:'<div style="text-align:center;">{Passing}</div>',text:"Passing",xtype:"templatecolumn",renderer:function(t,a,r){return e.renderLink(r,"Passing")}},{tpl:'<div style="text-align:center;">{Failing}</div>',text:"Failing",xtype:"templatecolumn",renderer:function(t,a,r){return e.renderLink(r,"Failing")}},{tpl:'<div style="text-align:center;">{NoRun}</div>',text:"NoRun",xtype:"templatecolumn",renderer:function(t,a,r){return e.renderLink(r,"NoRun")}},{tpl:'<div style="text-align:center;">{Other}</div>',text:"Other",xtype:"templatecolumn",renderer:function(t,a,r){return e.renderLink(r,"Other")}},{tpl:'<div style="text-align:center;"></div>',text:"User Story Coverage",xtype:"templatecolumn",renderer:function(e,t,a){var r={lightgreen:a.get("TotalCovered"),lightgrey:a.get("TotalStories")-a.get("TotalCovered")};return r&&Ext.isObject(r)?Ext.create("CArABU.technicalservices.ResultGraphTemplate").apply(r):""}},{tpl:'<div style="text-align:center;">{TotalCovered}</div>',text:"User Stories Covered",xtype:"templatecolumn"},{tpl:'<div style="text-align:center;">{TotalStories}</div>',text:"Total User Stories",xtype:"templatecolumn"}]},renderLink:function(e,t){return e.get(t).value>0?'<div style="text-align:center;"><a href="#">'+e.get(t).value+"</a></div>":'<div style="text-align:center;">0</a></div>'},showDrillDown:function(e,t,a,r){var o=e.panel.headerCt.getHeaderAtIndex(a).dataIndex||e.panel.headerCt.getHeaderAtIndex(a).text;if(Ext.Array.contains(["Passing","Failing","NoRun","Other","Total","GrandTotal","TotalPass","TotalFail","TotalOther","TotalNoRun"],o)){var l=r.get(o).records,i=Ext.create("Rally.data.custom.Store",{data:l,pageSize:2e3}),s="Records for "+o||"";Ext.create("Rally.ui.dialog.Dialog",{itemId:"detailPopup",title:s,width:.4*Ext.getBody().getWidth(),height:.4*Ext.getBody().getHeight(),closable:!0,layout:"border",items:[{xtype:"rallygrid",itemId:"popupGrid",region:"center",layout:"fit",sortableColumns:!0,showRowActionsColumn:!1,showPagingToolbar:!1,columnCfgs:this.getDrillDownColumns(s),store:i}]}).show()}},getDrillDownColumns:function(e){return[{dataIndex:"FormattedID",text:"id",renderer:function(e,t,a){return'<a href="'+(window.location.protocol+"//"+window.location.host+"/#/detail/testcase/"+a.get("ObjectID"))+'" target="_top" >'+a.get("FormattedID")+"</a>"}},{dataIndex:"Name",text:"Name",flex:1},{dataIndex:"Method",text:"Method",flex:1}]},_loadWsapiRecords:function(e){console.log("_loadWsapiRecords",e);var t=Ext.create("Deft.Deferred"),a=this;return Ext.create("Rally.data.wsapi.Store",Ext.Object.merge({model:"Defect",fetch:["ObjectID"]},e)).load({callback:function(e,r,o){o?t.resolve(e):(a.logger.log("Failed: ",r),t.reject("Problem loading: "+r.error.errors.join(". ")))}}),t.promise},getSettingsFields:function(){return[{xtype:"rallynumberfield",name:"gridWidth",margin:"5 0 5 0",fieldLabel:"Grid width (in pixels)",fieldWidth:100,width:200},{name:"saveLog",xtype:"rallycheckboxfield",boxLabelAlign:"after",fieldLabel:"",margin:"5 0 5 0",boxLabel:'Save Logging<br/><span style="color:#999999;"><i>Save last 100 lines of log for debugging.</i></span>'}]},getOptions:function(){return[{text:"About...",handler:this._launchInfo,scope:this}]},_launchInfo:function(){this.about_dialog&&this.about_dialog.destroy(),this.about_dialog=Ext.create("Rally.technicalservices.InfoLink",{showLog:this.getSetting("saveLog"),logger:this.logger})},isExternal:function(){return void 0===this.getAppId()},showErrorNotification:function(e){this.logger.log("showErrorNotification",e),Rally.ui.notify.Notifier.showError({message:e})}});

            Rally.launchApp('CArABU.app.TSApp', {
                name:"Feature Test Case Coverage Report",
                parentRepos:"",
                version:"0.2.0"
            });

        });
    </script>


    <style type="text/css">
        .x-border-layout-ct{background-color:white}.x-grid-body.x-panel-body{overflow-x:auto}.tsinfolink{position:absolute;right:0px;width:14px;height:14px;border-radius:7px;text-align:center;color:white;background:#C0C0C0;border-style:solid;border-width:1px;margin-top:25px;margin-right:5px;cursor:pointer}
    </style>
</head>
<body>
</body>
</html>
