<!DOCTYPE html>
<html>
<head>
    <title>CATS-Feature Test Case Coverage Report-0.1</title>
    <!--  (c) 2017 CA Technologies.  All Rights Reserved. -->
    <!--  Build Date: Fri Jan 26 2018 11:18:18 GMT-0800 (PST) -->

    <script type="text/javascript">
        var APP_BUILD_DATE = "Fri Jan 26 2018 11:18:18 GMT-0800 (PST)";
        var ARTIFACT = "F425";
        var BUILDER  = "rajan08";
        var CHECKSUM = 14546271229;
    </script>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>
    <!-- our highcharts (needed so that we can add patterns)
    <script type="text/javascript" src="/apps/2.1/lib/analytics/analytics-all.js"></script>
    -->


    <script type="text/javascript">
        Rally.onReady(function() {
            Ext.define("Rally.technicalservices.InfoLink",{extend:"Rally.ui.dialog.Dialog",alias:"widget.tsinfolink",informationHtml:null,title:"Build Information",defaults:{padding:5,margin:5},closable:!0,draggable:!0,autoShow:!0,width:350,informationalConfig:null,showLog:!1,logger:null,items:[{xtype:"container",itemId:"information"},{xtype:"container",itemId:"button_box"}],initComponent:function(){Ext.id(this);this.title="<span class='icon-help'> </span>"+this.title,this.callParent(arguments)},_generateChecksum:function(a){var b,c=305419896;for(a=a.replace(/var CHECKSUM = .*;/,""),a=a.replace(/var BUILDER  = .*;/,""),a=a.replace(/\s/g,""),b=0;b<a.length;b++)c+=a.charCodeAt(b)*b;return c},_checkChecksum:function(a){var b=Ext.create("Deft.Deferred"),c=this;return Ext.Ajax.request({url:document.URL,params:{id:1},success:function(a){if(text=a.responseText,CHECKSUM){var d=c._generateChecksum(text);if(CHECKSUM!==d)return void b.resolve(!1)}b.resolve(!0)}}),b.promise},_addToContainer:function(a){var b=Ext.apply({xtype:"container",height:200,overflowY:!0},this.informationalConfig);a.add(b)},afterRender:function(){var a=Rally.getApp();if(!Ext.isEmpty(this.informationalConfig)){var b=this.down("#information");this._addToContainer(b)}this.showLog&&this.logger&&this.down("#button_box").add({xtype:"rallybutton",text:"Show Log",listeners:{scope:this,click:function(){this.logger.displayLog()}}}),a.isExternal()?this.addDocked({xtype:"container",cls:"build-info",padding:2,dock:"bottom",html:"... Running externally"}):this._checkChecksum(a).then({scope:this,success:function(a){a||this.addDocked({xtype:"container",cls:"build-info",dock:"bottom",padding:2,html:'<span class="icon-warning"> </span>Checksums do not match'})},failure:function(a){console.log("oops:",a)}}),this.callParent(arguments)},beforeRender:function(){if(this.callParent(arguments),this.informationHtml&&this.addDocked({xtype:"component",componentCls:"intro-panel",padding:2,html:this.informationHtml,dock:"bottom"}),this.addDocked({xtype:"container",cls:"build-info",padding:2,dock:"bottom",html:"This app was created by the CA AC Technical Services Team."}),APP_BUILD_DATE){var a=Ext.String.format("Built on: {0} <br/>Built by: {1}",APP_BUILD_DATE,BUILDER);ARTIFACT&&(a=a+"<br/>Source artifact: "+ARTIFACT),this.addDocked({xtype:"container",cls:"build-info",padding:2,dock:"top",html:a})}}}),Ext.define("CArABU.technicalservices.Logger",{saveForLater:!1,saveLines:100,logArray:[],constructor:function(a){Ext.apply(this,a)},setSaveForLater:function(a){this.saveForLater=a},log:function(a){var b="[ "+Ext.util.Format.date(new Date,"Y-m-d H:i:s.u")+" ]",c=[];c=Ext.Array.push(c,[b]),c=Ext.Array.push(c,Ext.Array.slice(arguments,0)),this.saveForLater&&(this.logArray||(this.logArray=[]),this.logArray.push(c.join(" ")),this.logArray.length>this.saveLines&&this.logArray.shift()),window.console&&console.log.apply(console,c)},getLogText:function(){return this.logArray&&0!==this.logArray.length?this.logArray.join("<br/>"):"-- no log --"},displayLog:function(){var a=this.getLogText();this.popup=Ext.create("Rally.ui.dialog.Dialog",{width:Ext.getBody().getWidth()-20,height:Ext.getBody().getHeight()-20,closable:!0,title:"Log",autoShow:!0,layout:"border",defaults:{layout:"fit",width:"50%",border:!1},items:[{region:"center",xtype:"container",html:a,autoScroll:!0}]})}}),Ext.define("TSUtilities",{singleton:!0,loadWsapiRecords:function(a){var b=Ext.create("Deft.Deferred"),c={model:"Defect",fetch:["ObjectID"]};return Ext.create("Rally.data.wsapi.Store",Ext.Object.merge(c,a)).load({callback:function(a,c,d){d?b.resolve(a):(console.error("Failed: ",c),b.reject("Problem loading: "+c.error.errors.join(". ")))}}),b.promise},loadAStoreWithAPromise:function(a,b){var c=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",{model:a,fetch:b}).load({callback:function(a,b,d){d?c.resolve(this):(console.error("Failed: ",b),c.reject("Problem loading: "+b.error.errors.join(". ")))}}),c.promise}}),Ext.define("CArABU.technicalservices.chunk.Store",{MAX_CHUNK_SIZE:50,logger:new CArABU.technicalservices.Logger,constructor:function(a){this.chunkProperty=a.chunkProperty,this.chunkValue=a.chunkValue,this.storeConfig=a.storeConfig||{},this.storeType=a.storeType||"Rally.data.wsapi.Store"},load:function(){for(var a=Ext.create("Deft.Deferred"),b=[],c=this.chunkValue,d=this.storeConfig,e=0;e<c.length;e+=this.MAX_CHUNK_SIZE){var f=Ext.Array.slice(c,e,e+this.MAX_CHUNK_SIZE);b.push(this._fetchChunk(f,d))}return Deft.Promise.all(b).then({success:function(b){var c=_.flatten(b);this.logger.log("load SUCCESS results",b,c),a.resolve(c)},failure:function(b){this.logger.log("load FAILURE",c,b),a.reject(b)},scope:this}),a},_fetchChunk:function(a,b){this.logger.log("chunk.Store._fetchChunk",a,b);var c=Ext.create("Deft.Deferred"),d=this.chunkProperty,e=_.map(a,function(a){return{property:d,value:a}});e=Rally.data.wsapi.Filter.or(e),b.filters&&(Ext.isArray(b.filters)&&(b.filters=Rally.data.wsapi.Filter.and(b.filters)),e=e.and(b.filters)),this.logger.log("chunk.Store._fetchChunk",e.toString());var f=b.fetch||!0,g=b.model||"HierarchicalRequirement";return Ext.create(this.storeType,{fetch:f,filters:e,model:g,context:{project:null}}).load({callback:function(b,d,e){if(e)c.resolve(b);else{var f="Failure loading records for objectIDs: "+a.join(", ")+":  "+d.error.errors.join(",");c.resolve(f)}}}),c}}),Ext.override(Rally.data.wsapi.TreeStore,{_decorateModels:function(){var a=this.model;_.isFunction(a.getArtifactComponentModels)&&(a=a.getArtifactComponentModels()),Ext.Array.each(a,function(a){a.addField({name:"Passing",type:"auto",defaultValue:0}),a.addField({name:"Failing",type:"auto",defaultValue:0}),a.addField({name:"NoRun",type:"auto",defaultValue:0}),a.addField({name:"Other",type:"auto",defaultValue:0}),a.addField({name:"TotalStories",type:"auto",defaultValue:0}),a.addField({name:"TotalCovered",type:"auto",defaultValue:0})}),_.each(Ext.Array.from(a),Rally.ui.grid.data.NodeInterface.decorate,Rally.ui.grid.data.NodeInterface)}}),Ext.override(Rally.ui.renderer.template.ScheduleStateTemplate,{_getSymbolState:function(a,b){var c;return c=a.ScheduleStatePrefix?a.ScheduleStatePrefix:"In-Progress"===b?"P":b.charAt(0)}}),Ext.override(Rally.ui.grid.TreeGrid,{_mergeColumnConfigs:function(a,b){var c=_.map(a,function(a){var c=_.find(b,{dataIndex:this._getColumnName(a)});return c?this._getColumnConfigFromColumn(c):a},this);return c=c.concat(this.config.derivedColumns)},_restoreColumnOrder:function(a){var b=this._getColumnConfigsBasedOnCurrentOrder(a),c=_.filter(a,function(a){return!_.find(b,{dataIndex:a.dataIndex})||Ext.isString(a)});return b.concat(c)},_applyStatefulColumns:function(a){this.alwaysShowDefaultColumns&&_.each(this.columnCfgs,function(b){_.any(a,{dataIndex:this._getColumnName(b)})||a.push(b)},this),this.config&&this.config.derivedColumns?this.columnCfgs=a.concat(this.config.derivedColumns):this.columnCfgs=a}}),Ext.override(Rally.nav.DetailLink,{getLink:function(a){var b=a.record.isModel?a.record.data:a.record,c=(Rally.util.Window.isInFrame()?"_top":"",""),d=Rally.nav.Manager.getDetailUrl(b,a);if(!d)return a.text;var e=a.showHover!==!1&&window.activateEl;e&&(c=this._getHoverText(b._ref));var f=Rally.util.Ref.getOidFromRef(b._ref);return this.template.apply({href:d,target:"_blank",onclick:a.onclick,text:a.text,hover:c,tooltip:a.showTooltip!==!1,id:e?"hov"+f:""})}}),Ext.define("CArABU.technicalservices.ResultGraphTemplate",{extend:"Ext.XTemplate",width:"90%",height:"20px",config:{calculateColorFn:function(a){return colors[a]},getContainerClass:function(a){return""},getClickableClass:function(){return""},getDimensionStyle:function(){return"width: "+this.width+"; height: "+this.height+"; line-height: "+this.height+";display: inline-block"},calculateWidth:function(a,b){var c=Ext.Array.sum(Ext.Object.getValues(a));if(c>0){var d=(a[b]||0)/c*100;return d+"%"}return 0}},constructor:function(a){var b=["<tpl>",'<div class="progress-bar-container {[this.getClickableClass()]} {[this.getContainerClass(values)]}" style="{[this.getDimensionStyle()]}">','<tpl foreach=".">','<div class="rly-progress-bar" style="text-align:center;background-color: {$}; width: {[this.calculateWidth(parent,xkey)]}; "></div>',"</tpl>","</div>","</tpl>"];return this.callParent(b)}}),Ext.define("CArABU.app.TSApp",{extend:"Rally.app.App",componentCls:"app",logger:new CArABU.technicalservices.Logger,defaults:{margin:10},layout:"border",items:[{xtype:"container",itemId:"selector_box",layout:{type:"hbox"},margin:"10 10 50 10"},{xtype:"container",itemId:"display_box",margin:"50 10 10 10"}],integrationHeaders:{name:"CArABU.app.TSApp"},modelNames:["PortfolioItem/Feature"],launch:function(){var a=this;this.logger.setSaveForLater(this.getSetting("saveLog")),a._addSelector()},_addSelector:function(){var a=this;a.down("#selector_box").add([{xtype:"rallyreleasecombobox",name:"releaseCombo",itemId:"releaseCombo",stateful:!0,stateId:a.getContext().getScopedStateId("releaseCombo"),fieldLabel:"Select Release:",multiSelect:!0,margin:"10 10 10 10",width:450,labelWidth:100,cls:"rally-checkbox-combobox",valueField:"Name",displayField:"Name",listeners:{change:a.updateView,scope:a},listConfig:{cls:"rally-checkbox-boundlist",itemTpl:Ext.create("Ext.XTemplate",'<div class="rally-checkbox-image"></div>',"{[this.getDisplay(values)]}</div>",{getDisplay:function(a){return a.Name}})}}])},updateView:function(){var a=this;if(a.down("#releaseCombo")){console.log("releases >",a.down("#releaseCombo").value);var b=[];a.setLoading(!0),a._getSelectedPIs(a.modelNames[0]).then({success:function(c){Ext.Array.each(c,function(a){b.push(a.get("ObjectID"))}),Deft.Promise.all([a._getTCFromSnapShotStore(b),a._getUSFromSnapShotStore(b)]).then({success:function(b){console.log("results",b),a.lb_tc_results=b[0];var c=[];a.lb_us_results=b[1];Ext.Array.each(b[0],function(a){c.push(a.get("_ItemHierarchy")[a.get("_ItemHierarchy").length-2])}),a._getTCs(c).then({success:function(b){console.log("_getTCs>>",b),a.lastVerdict={},Ext.Array.each(b,function(b){a.lastVerdict[b.get("ObjectID")]=b.get("LastVerdict")}),Ext.create("Rally.data.wsapi.TreeStoreBuilder").build({models:a.modelNames,enableHierarchy:!0}).then({success:a._addGrid,scope:a})},scope:a})},scope:a})},scope:a})}},_getSelectedPIs:function(a,b){var c=this,d={model:a,fetch:["ObjectID","AcceptedLeafStoryPlanEstimateTotal","LeafStoryPlanEstimateTotal","PlanEstimate","ScheduleState"],limit:"Infinity"};return b&&(d.filters=b),c._loadWsapiRecords(d)},_getTCs:function(a){var b=Ext.create("Deft.Deferred"),c=this;return Ext.create("CArABU.technicalservices.chunk.Store",{storeConfig:{model:"TestCase",fetch:["ObjectID","LastVerdict"]},chunkProperty:"WorkProduct.ObjectID",chunkValue:a}).load().then({success:function(a){b.resolve(a)},failure:c.showErrorNotification,scope:c}),b.promise},_getUserStories:function(a){var b=Ext.create("Deft.Deferred"),c=this;return Ext.create("CArABU.technicalservices.chunk.Store",{storeConfig:{model:"HierarchicalRequirement",fetch:["ObjectID"]},chunkProperty:"ObjectID",chunkValue:a}).load().then({success:function(a){b.resolve(a)},failure:c.showErrorNotification,scope:c}),b.promise},_getTCFromSnapShotStore:function(a){var b=this,c=Ext.create("Deft.Deferred"),d={_TypeHierarchy:"TestCase",_ItemHierarchy:{$in:a}};d.__At="current";var e=Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["ObjectID","LastVerdict","_ItemHierarchy"],find:d,useHttpPost:!0});return e.load({callback:function(a,d){console.log("operation>>",d),d.wasSuccessful()?c.resolve(a):(403===d.error.status?b.showErrorNotification("You do not have required permissions to access the data."):b.showErrorNotification("Problem Loading"),b.setLoading(!1))},scope:b}),c},_getUSFromSnapShotStore:function(a){var b=this,c=Ext.create("Deft.Deferred"),d={_TypeHierarchy:"HierarchicalRequirement",_ItemHierarchy:{$in:a}};d.__At="current";var e=Ext.create("Rally.data.lookback.SnapshotStore",{fetch:["ObjectID","_ItemHierarchy","FormattedID","TestCases"],find:d,useHttpPost:!0});return e.load({callback:function(a,d){console.log("operation>>",d),d.wasSuccessful()?c.resolve(a):(403===d.error.status?b.showErrorNotification("You do not have required permissions to access the data."):b.showErrorNotification("Problem Loading"),b.setLoading(!1))},scope:b}),c},_addGrid:function(a){var b=this,c=b.getContext();a.on("load",b._updateAssociatedData,b);var d=[];Ext.Array.each(b.down("#releaseCombo").value,function(a){d.push({property:"Release.Name",value:a})}),d=Rally.data.wsapi.Filter.or(d),console.log("Filter>>",d&&d.toString()),b.down("#display_box").removeAll(),b.down("#display_box").add({itemId:"pigridboard",xtype:"rallygridboard",context:c,modelNames:b.modelNames,toggleState:"grid",stateful:!1,plugins:b._getPlugins(),gridConfig:{store:a,enableEditing:!1,storeConfig:{filters:d},columnCfgs:["Name","ScheduleState","Owner","PlanEstimate"],derivedColumns:b.getDerivedColumns(),shouldShowRowActionsColumn:!1,enableRanking:!1,enableBulkEdit:!1},height:b.getHeight(),width:b.getWidth()}),b.setLoading(!1)},_updateAssociatedData:function(a,b,c,d){var e=this;e.suspendLayouts(),Ext.Array.each(c,function(a){var b=0,c=0,d=0,f=0,g=0,h=0;Ext.Array.each(e.lb_tc_results,function(g){Ext.Array.contains(g.get("_ItemHierarchy"),a.get("ObjectID"))&&("Pass"==e.lastVerdict[g.get("ObjectID")]?b++:"Fail"==e.lastVerdict[g.get("ObjectID")]?c++:null==e.lastVerdict[g.get("ObjectID")]||""==e.lastVerdict[g.get("ObjectID")]?d++:f++)}),Ext.Array.each(e.lb_us_results,function(b){Ext.Array.contains(b.get("_ItemHierarchy"),a.get("ObjectID"))&&(g++,b.get("TestCases")&&b.get("TestCases").length>0&&h++)}),a.set("Passing",b),a.set("Failing",c),a.set("NoRun",d),a.set("Other",f),a.set("TotalStories",g),a.set("TotalCovered",h)}),e.resumeLayouts()},_getPlugins:function(){var a=this,b=[{ptype:"rallygridboardinlinefiltercontrol",inlineFilterButtonConfig:{stateful:!0,stateId:a.getContext().getScopedStateId("filters"),modelNames:a.modelNames,inlineFilterPanelConfig:{collapsed:!1,quickFilterPanelConfig:{defaultFields:["ArtifactSearch","Owner"],addQuickFilterConfig:{whiteListFields:["Milestones","Tags"]}},advancedFilterPanelConfig:{advancedFilterRowsConfig:{propertyFieldConfig:{whiteListFields:["Milestones","Tags"]}}}}}}];return b.push({ptype:"rallygridboardfieldpicker",headerPosition:"left",modelNames:a.modelNames,stateful:!0,gridAlwaysSelectedValues:["Name","Owner"],stateId:a.getContext().getScopedStateId("field-picker")}),b},_getColumnCfgs:function(){var a=this;return[{dataIndex:"Name",text:"Name",flex:1},{dataIndex:"ScheduleState",text:"Schedule State"},{dataIndex:"Owner",text:"Owner"}].concat(a.getDerivedColumns())},getDerivedColumns:function(){return[{tpl:'<div style="text-align:center;"></div>',text:"Result Graph",xtype:"templatecolumn",renderer:function(a,b,c){var d={lightgreen:c.get("Passing"),red:c.get("Failing"),yellow:c.get("NoRun"),blue:c.get("Other")};if(d&&Ext.isObject(d)){var e=Ext.create("CArABU.technicalservices.ResultGraphTemplate");return e.apply(d)}return""}},{tpl:'<div style="text-align:center;">{Passing}</div>',text:"Passing",xtype:"templatecolumn"},{tpl:'<div style="text-align:center;">{Failing}</div>',text:"Failing",xtype:"templatecolumn"},{tpl:'<div style="text-align:center;">{NoRun}</div>',text:"No Run",xtype:"templatecolumn"},{tpl:'<div style="text-align:center;">{Other}</div>',text:"Other",xtype:"templatecolumn"},{tpl:'<div style="text-align:center;"></div>',text:"User Story Coverage",xtype:"templatecolumn",renderer:function(a,b,c){var d={lightgreen:c.get("TotalCovered"),white:c.get("TotalStories")-c.get("TotalCovered")};if(d&&Ext.isObject(d)){var e=Ext.create("CArABU.technicalservices.ResultGraphTemplate");return e.apply(d)}return""}},{tpl:'<div style="text-align:center;">{TotalCovered}</div>',text:"User Stories Covered",xtype:"templatecolumn"},{tpl:'<div style="text-align:center;">{TotalStories}</div>',text:"Total User Stories",xtype:"templatecolumn"}]},_loadWsapiRecords:function(a){console.log("_loadWsapiRecords",a);var b=Ext.create("Deft.Deferred"),c=this,d={model:"Defect",fetch:["ObjectID"]};return Ext.create("Rally.data.wsapi.Store",Ext.Object.merge(d,a)).load({callback:function(a,d,e){e?b.resolve(a):(c.logger.log("Failed: ",d),b.reject("Problem loading: "+d.error.errors.join(". ")))}}),b.promise},getSettingsFields:function(){var a="5 0 5 0";return[{name:"saveLog",xtype:"rallycheckboxfield",boxLabelAlign:"after",fieldLabel:"",margin:a,boxLabel:'Save Logging<br/><span style="color:#999999;"><i>Save last 100 lines of log for debugging.</i></span>'}]},getOptions:function(){var a=[{text:"About...",handler:this._launchInfo,scope:this}];return a},_launchInfo:function(){this.about_dialog&&this.about_dialog.destroy(),this.about_dialog=Ext.create("Rally.technicalservices.InfoLink",{showLog:this.getSetting("saveLog"),logger:this.logger})},isExternal:function(){return"undefined"==typeof this.getAppId()}});

               Rally.launchApp('CArABU.app.TSApp', {
                   name: 'Feature Test Case Coverage Report'
               });
        });
    </script>

    <style type="text/css">

.app {
}
.tsinfolink {
    position:absolute;
    right:0px;
    width: 14px;
    height: 14px;
    border-radius: 7px;
    text-align: center;
    color: white;
    background: #C0C0C0;
    border-style: solid;
    border-width: 1px;
    margin-top: 25px;
    margin-right: 5px;
    cursor: pointer;
}
    </style>

</head>
<body></body>
</html>